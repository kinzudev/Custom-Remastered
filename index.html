<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Simulador Roblox - Catalog</title>
  <style>
    *{box-sizing:border-box;font-family:Arial,Helvetica,sans-serif}
    body{margin:0;background:#222;color:#222}
    a{color:inherit;text-decoration:none}

    .topbar{background:#f60;color:#fff;padding:10px 18px;text-align:center;font-weight:700;position:relative}

    /* Robux display */
    #robuxDisplay{position:absolute;top:6px;right:20px;display:flex;align-items:center;gap:6px;font-weight:bold;color:#00aa00}
    #robuxDisplay img{width:26px;height:26px}

    .app{display:flex;min-height:calc(100vh - 40px)}
    .sidebar{width:220px;background:#2f2f2f;color:#ddd;padding:18px}
    .sidebar h2{color:#fff;font-size:16px;margin:6px 0}
    .sidebar a{display:block;color:#bfbfbf;padding:8px 4px}
    .upgrade{display:inline-block;background:#08f;color:#fff;padding:8px 10px;border-radius:4px;margin-top:12px}

    .main{flex:1;padding:18px;background:#fafafa}

    .banner{height:120px;background-image:url('/mnt/data/59983a73-6d5c-45b0-9e3d-d39c2935bedf.png');background-size:cover;background-position:center;margin-bottom:12px;border-radius:4px}

    .catalog{display:flex}
    .filters{width:180px;margin-right:18px}
    .filters h3{margin:0 0 8px}
    .items{flex:1}

    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:14px}
    .card{background:#fff;border:1px solid #ddd;padding:10px;border-radius:6px;text-align:center;cursor:pointer;transition:transform 0.15s}
    .card:hover{transform:scale(1.04)}
    .card img{width:100%;height:120px;object-fit:contain;border-bottom:1px solid #ddd;margin-bottom:6px}
    .card .title{font-size:14px;margin:4px 0;color:#333;font-weight:bold}
    .card .tag{font-size:12px;color:#666}
    .card .price{color:#0a8b00;font-weight:700;font-size:13px}

    .overlay{position:fixed;inset:0;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center}
    .modal{background:#fff;padding:20px;border-radius:8px;max-width:420px;width:100%}
    .modal h2{margin-top:0}
    .form-row{margin-bottom:10px}
    input[type=text],input[type=password],input[type=email]{width:100%;padding:8px;border:1px solid #ccc;border-radius:4px}
    button{padding:8px 12px;border:0;border-radius:6px;background:#0666ff;color:#fff;cursor:pointer}
    .muted{color:#666;font-size:13px}
  </style>
</head>
<body>
  <div class="topbar">Simulador de Catálogo
    <div id="robuxDisplay"><img src="/mnt/data/ROBUX_2014_Logo.svg.png" alt="R$"> <span id="robuxAmount">0</span></div>
  </div>

  <div class="app">
    <aside class="sidebar">
      <h2>Menú</h2>
      <a href="#" id="inventoryLink">Inventario</a>
      <a class="upgrade" href="#" id="logoutBtn">Salir</a>
    </aside>

    <main class="main">
      <div class="banner" aria-hidden="true"></div>

      <section class="items">
        <h3>Catálogo</h3>
        <div id="itemsGrid" class="grid"></div>
      </section>
    </main>
  </div>

  <!-- Auth modal -->
  <div id="authOverlay" class="overlay">
    <div class="modal">
      <h2 id="authTitle">Iniciar sesión / Registrarse</h2>
      <div class="form-row"><input id="email" type="email" placeholder="Correo electrónico"></div>
      <div class="form-row"><input id="password" type="password" placeholder="Contraseña"></div>
      <div style="display:flex;gap:8px"><button id="loginBtn">Iniciar sesión</button><button id="registerBtn">Registrarse</button></div>
      <p class="muted">Solo el usuario <b>kinzudev@gmail.com</b> puede agregar ítems al catálogo.</p>
    </div>
  </div>

  <!-- Firebase -->
  <script type="module">
    const firebaseConfig = {
      apiKey: "AIzaSyBwj_as6pb5Bg81F9Cl9VWTKkekMM9Exfk",
      authDomain: "pekora-forum.firebaseapp.com",
      projectId: "pekora-forum",
      storageBucket: "pekora-forum.firebasestorage.app",
      messagingSenderId: "161910967859",
      appId: "1:161910967859:web:6a28cecaae74b9b7e9dd46",
      measurementId: "G-BPBTW5KBRK"
    };

    import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js';
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js';
    import { getFirestore, collection, addDoc, onSnapshot, doc, updateDoc, setDoc, getDocs } from 'https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js';

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const authOverlay = document.getElementById('authOverlay');
    const emailInput = document.getElementById('email');
    const passwordInput = document.getElementById('password');
    const loginBtn = document.getElementById('loginBtn');
    const registerBtn = document.getElementById('registerBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const itemsGrid = document.getElementById('itemsGrid');
    const robuxAmount = document.getElementById('robuxAmount');
    const inventoryLink = document.getElementById('inventoryLink');

    let currentUser = null;
    let viewingInventory = false;

    // Login/Register
    registerBtn.addEventListener('click', async()=>{
      try{await createUserWithEmailAndPassword(auth,emailInput.value.trim(),passwordInput.value);}catch(e){alert(e.message)}
    });
    loginBtn.addEventListener('click', async()=>{
      try{await signInWithEmailAndPassword(auth,emailInput.value.trim(),passwordInput.value);}catch(e){alert(e.message)}
    });
    logoutBtn.addEventListener('click', async()=>{await signOut(auth);});

    onAuthStateChanged(auth, async user=>{
      currentUser=user;
      if(user){authOverlay.style.display='none';initApp();}
      else{authOverlay.style.display='flex';itemsGrid.innerHTML='';robuxAmount.textContent='0';}
    });

    async function initApp(){
      // initialize robux
      const balDoc = doc(db,'users',currentUser.uid);
      await setDoc(balDoc,{robux:1000},{merge:true});
      onSnapshot(balDoc,snap=>{if(snap.exists())robuxAmount.textContent=snap.data().robux||0});

      if(currentUser.email==='kinzudev@gmail.com') enableAdminAdd();
      loadItems();
    }

    function enableAdminAdd(){
      const addBtn=document.createElement('button');
      addBtn.textContent='Agregar ítem';
      addBtn.style.margin='10px 0';
      addBtn.onclick=async()=>{
        const title=prompt('Nombre del ítem:');
        if(!title)return;
        const image=prompt('URL de imagen:');
        const price=parseInt(prompt('Precio R$:'))||0;
        const rap=parseInt(prompt('RAP (valor estimado):'))||0;
        await addDoc(collection(db,'items'),{title,image,price,rap});
      };
      document.querySelector('.items').prepend(addBtn);
    }

    function loadItems(){
      const col=collection(db,'items');
      onSnapshot(col,snap=>{
        itemsGrid.innerHTML='';
        snap.forEach(docSnap=>{
          const d=docSnap.data();
          const c=document.createElement('div');
          c.className='card';
          c.innerHTML=`<img src="${d.image||''}"><div class="title">${d.title}</div><div class="tag">RAP: ${d.rap||0}</div><div class="price">R$${d.price}</div>`;
          c.onclick=()=>buyItem(docSnap.id,d);
          itemsGrid.appendChild(c);
        });
      });
    }

    async function buyItem(id,data){
      if(!currentUser)return alert('Inicia sesión');
      const userDoc=doc(db,'users',currentUser.uid);
      const snap=await (await import('https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js')).getDoc(userDoc);
      let robux=snap.exists()?snap.data().robux||0:0;
      if(robux<data.price)return alert('No tienes Robux suficientes');
      robux-=data.price;
      await updateDoc(userDoc,{robux});
      const invCol=collection(db,'users',currentUser.uid,'inventory');
      await addDoc(invCol,data);
      alert('Item comprado');
    }

    inventoryLink.addEventListener('click',()=>{
      if(!currentUser)return;
      viewingInventory=!viewingInventory;
      if(viewingInventory)showInventory();else loadItems();
    });

    async function showInventory(){
      const invCol=collection(db,'users',currentUser.uid,'inventory');
      const docs=await getDocs(invCol);
      itemsGrid.innerHTML='';
      docs.forEach(docSnap=>{
        const d=docSnap.data();
        const c=document.createElement('div');
        c.className='card';
        c.innerHTML=`<img src="${d.image||''}"><div class="title">${d.title}</div><div class="tag">RAP: ${d.rap||0}</div><div class="price">R$${d.price}</div>`;
        itemsGrid.appendChild(c);
      });
    }
  </script>
</body>
</html>
