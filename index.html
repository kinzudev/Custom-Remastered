<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Simulador Roblox - Catalog</title>
  <style>
    /* Reset & basic layout */
    *{box-sizing:border-box;font-family:Arial,Helvetica,sans-serif}
    body{margin:0;background:#222;background-image:linear-gradient(180deg,#222, #1a1a1a);color:#222}
    a{color:inherit}

    /* Top bar */
    .topbar{background:#f60;color:#fff;padding:10px 18px;text-align:center;font-weight:700}

    /* App frame */
    .app{display:flex;min-height:calc(100vh - 40px)}
    .sidebar{width:220px;background:#2f2f2f;color:#ddd;padding:18px}
    .sidebar h2{color:#fff;font-size:16px;margin:6px 0}
    .sidebar a{display:block;color:#bfbfbf;padding:8px 4px;text-decoration:none}
    .upgrade{display:inline-block;background:#08f;color:#fff;padding:8px 10px;border-radius:4px;margin-top:12px}

    .main{flex:1;padding:18px;background:rgba(255,255,255,0.95)}

    /* Header banner that mimics the image */
    .banner{height:120px;background-image:url('/mnt/data/59983a73-6d5c-45b0-9e3d-d39c2935bedf.png');background-size:cover;background-position:center;margin-bottom:12px;border-radius:4px;filter:grayscale(0.2)brightness(0.9)}

    .catalog{display:flex}
    .filters{width:180px;margin-right:18px}
    .filters h3{margin:0 0 8px}
    .items{flex:1}

    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:14px}
    .card{background:#fff;border:1px solid #ddd;padding:10px;border-radius:6px;text-align:center}
    .card img{width:100%;height:100px;object-fit:contain}
    .card .title{font-size:13px;margin:6px 0;color:#333}
    .card .price{color:#0a8b00;font-weight:700}

    /* Auth modal */
    .overlay{position:fixed;inset:0;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center}
    .modal{background:#fff;padding:20px;border-radius:8px;max-width:420px;width:100%}
    .modal h2{margin-top:0}
    .form-row{margin-bottom:10px}
    input[type=text],input[type=password],input[type=email]{width:100%;padding:8px;border:1px solid #ccc;border-radius:4px}
    button{padding:8px 12px;border:0;border-radius:6px;background:#0666ff;color:#fff;cursor:pointer}
    .muted{color:#666;font-size:13px}

    /* Small responsive tweaks */
    @media (max-width:800px){.sidebar{display:none}.catalog{flex-direction:column}.filters{width:100%;margin-bottom:12px}.banner{height:90px}}
  </style>
</head>
<body>
  <div class="topbar">Simulador de Catalogo - Abre sesión para continuar</div>

  <div class="app">
    <aside class="sidebar">
      <h2>Menú</h2>
      <a href="#" id="profileLink">Perfil</a>
      <a href="#" id="messagesLink">Mensajes</a>
      <a href="#" id="friendsLink">Amigos</a>
      <a href="#" id="inventoryLink">Inventario</a>
      <a class="upgrade" href="#" id="logoutBtn">Salir</a>
    </aside>

    <main class="main">
      <div class="banner" aria-hidden="true"></div>

      <div class="catalog">
        <div class="filters">
          <h3>Filtros</h3>
          <div class="muted">Género</div>
          <label><input type="checkbox" value="All" checked disabled> Todos</label>
          <hr>
          <button id="seedBtn">Agregar ítems de ejemplo (seed)</button>
        </div>

        <section class="items">
          <h3>Featured Items</h3>
          <div id="itemsGrid" class="grid"></div>
        </section>
      </div>
    </main>
  </div>

  <!-- Auth modal (register/login) -->
  <div id="authOverlay" class="overlay">
    <div class="modal">
      <h2 id="authTitle">Iniciar sesión / Registrarse</h2>

      <div class="form-row">
        <input id="email" type="email" placeholder="Correo electrónico">
      </div>
      <div class="form-row">
        <input id="password" type="password" placeholder="Contraseña">
      </div>

      <div style="display:flex;gap:8px">
        <button id="loginBtn">Iniciar sesión</button>
        <button id="registerBtn">Registrarse</button>
      </div>

      <p class="muted" style="margin-top:10px">Usaremos Firebase Authentication + Firestore (tiempo real) para usuarios y catálogo.</p>
    </div>
  </div>

  <!-- Firebase (modular SDK via CDN) -->
  <script type="module">
    // Insert your firebaseConfig here (you already provided it) -- it's embedded below
    const firebaseConfig = {
            apiKey: "AIzaSyBwj_as6pb5Bg81F9Cl9VWTKkekMM9Exfk",
            authDomain: "pekora-forum.firebaseapp.com",
            projectId: "pekora-forum",
            storageBucket: "pekora-forum.firebasestorage.app",
            messagingSenderId: "161910967859",
            appId: "1:161910967859:web:6a28cecaae74b9b7e9dd46",
            measurementId: "G-BPBTW5KBRK"
    };

    import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js';
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js';
    import { getFirestore, collection, addDoc, onSnapshot, doc, setDoc, getDocs, query } from 'https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js';

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // UI refs
    const authOverlay = document.getElementById('authOverlay');
    const emailInput = document.getElementById('email');
    const passwordInput = document.getElementById('password');
    const loginBtn = document.getElementById('loginBtn');
    const registerBtn = document.getElementById('registerBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const itemsGrid = document.getElementById('itemsGrid');
    const seedBtn = document.getElementById('seedBtn');

    // Auth handlers
    registerBtn.addEventListener('click', async()=>{
      try{
        const email=emailInput.value.trim();
        const pass=passwordInput.value;
        const userCred = await createUserWithEmailAndPassword(auth,email,pass);
        console.log('Registrado',userCred.user.uid);
      }catch(e){alert('Error al registrar: '+e.message)}
    });

    loginBtn.addEventListener('click', async()=>{
      try{
        const email=emailInput.value.trim();
        const pass=passwordInput.value;
        const userCred = await signInWithEmailAndPassword(auth,email,pass);
        console.log('Logged in',userCred.user.uid);
      }catch(e){alert('Error al iniciar sesión: '+e.message)}
    });

    logoutBtn.addEventListener('click', async()=>{
      await signOut(auth);
    });

    onAuthStateChanged(auth,user=>{
      if(user){
        // hide auth overlay and start listening to items
        authOverlay.style.display='none';
        startItemsListener();
      } else {
        // show overlay
        authOverlay.style.display='flex';
        itemsGrid.innerHTML='';
        stopItemsListener();
      }
    });

    // Firestore real-time items listener
    let unsubscribeItems = null;
    function startItemsListener(){
      const itemsCol = collection(db,'items');
      unsubscribeItems = onSnapshot(itemsCol, snapshot=>{
        // render
        itemsGrid.innerHTML='';
        snapshot.forEach(docSnap=>{
          const data = docSnap.data();
          const card = document.createElement('div');
          card.className='card';
          card.innerHTML = `\n            <img src="${data.image || 'https://via.placeholder.com/150'}" alt="${escapeHtml(data.title || '')}">\n            <div class="title">${escapeHtml(data.title || 'Sin título')}</div>\n            <div class="price">${data.price ? 'R$'+data.price : '<span class="muted">Gratis</span>'}</div>\n          `;
          itemsGrid.appendChild(card);
        });
      }, err=>{console.error('items listener err',err)});
    }

    function stopItemsListener(){
      if(unsubscribeItems) unsubscribeItems();
      unsubscribeItems = null;
    }

    function escapeHtml(s){return String(s).replace(/[&<>"']/g,function(c){return{'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[c]})}

    // seed example items into Firestore (adds simple demo data). In production, restrict this behind admin checks.
    seedBtn.addEventListener('click', async()=>{
      try{
        const demo = [
          {title:'Creepy Bunny',price:40,image:'https://i.imgur.com/3yKQw2R.png'},
          {title:'Halloween Cap',price:25,image:'https://i.imgur.com/0XK1z8I.png'},
          {title:'Ghost Ship',price:150,image:'https://i.imgur.com/2bQx7mQ.png'},
          {title:'Sinister Pumpkin',price:60,image:'https://i.imgur.com/9hQkV8L.png'},
          {title:'Orange Winter Scarf',price:0,image:'https://i.imgur.com/6b1xA1z.png'}
        ];
        for(const it of demo){
          await addDoc(collection(db,'items'),it);
        }
        alert('Ítems de ejemplo agregados. Se verán en tiempo real en la cuadrícula.');
      }catch(e){console.error(e);alert('Error al crear ítems: '+e.message)}
    });

    // Optional: load existing items once (if you want snapshot-based only we already handle above)
  </script>

  <!-- Small note for local testing -->
  <script>
    // Because the HTML is a single file, when you open it locally the Firebase SDK may require it to be served from http(s).
    // Best practice: host on a local dev server (e.g. `npx serve .` or `python -m http.server`) or deploy to Firebase Hosting.
    console.log('Simulador listo. Abre la página en un servidor local para evitar problemas con módulos y Firebase.');
  </script>
</body>
</html>
